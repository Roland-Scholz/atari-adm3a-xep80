PTR	EQU 0DDEVIC	EQU $300DUNIT	EQU $301DCOMND	EQU $302DSTATS	EQU $303DBUFLO	EQU $304DBUFHI	EQU $305DTIMLO	EQU $306DBYTLO	EQU $308DBYTHI	EQU $309DAUX1	EQU $30ADAUX2	EQU $30BDISKV	EQU $E453CIOV	EQU $E456SIOV	EQU $E459COPEN	EQU 03CGETR	EQU 7CPUTR	EQU 11CCLOSE	EQU 12CBAUD	EQU 36CTRANS	EQU 38CCONCUR	EQU 40ICCOM	EQU $342ICBADR	EQU $344ICBLEN	EQU $348ICAUX1	EQU $34AICAUX2	EQU $34BEOL	EQU $9BBUFFER	EQU $4C00*	ORG $A800*START	JSR GEOUTCH	LDX #0	STX SECNUM	STX SECNUM+1	STX SECCNT+1	INX	STX SECCNT	JSR OPENSER	JSR ACK	LDX #$10	LDA #CGETR	STA ICCOM,X	LDA #4	STA ICBLEN,X	LDA #0	STA ICBLEN+1,X	LDA #SECLEN:L	STA ICBADR,X	LDA #SECLEN:H	STA ICBADR+1,X	JSR CIOV** SECTOR LOOP*LOOP	JSR IBUFADRLOOP3	JSR RECSEC	BMI ERROR	JSR ABUFADR	LDA BUFCNT	CMP #1	BEQ LOOP6	JSR ACKLOOP6	DEC BUFCNT	BNE LOOP3	JSR SERCLO	JSR NEWLINE	JSR IBUFADRLOOPSEC	LDA #'#	JSR PRINT	LDA SECCNT	LDX SECCNT+1	JSR PRTWORD	JSR WRISEC	BMI ERROR	JSR ABUFADR	INC SECCNT	BNE LOOP4	INC SECCNT+1LOOP4	DEC BUFCNT	BNE LOOPSEC		SEC	LDA SECNUM	SBC BUFSEC	STA SECNUM	LDA SECNUM+1	SBC #0	STA SECNUM+1	JSR OPENSER	JSR ACK	LDA SECNUM	ORA SECNUM+1	BNE LOOP	JMP SERCLO***ERROR	TYA	JSR PUTHEXSERCLO	LDX #$10	LDA #CCLOSE	STA ICCOM,X	JMP CIOV*ABUFADR	CLC	LDA BUFADR	ADC SECLEN	STA BUFADR	LDA BUFADR+1	ADC SECLEN+1	STA BUFADR+1	RTS*IBUFADR	LDA #BUFFER:L	STA BUFADR	LDA #BUFFER:H	STA BUFADR+1	LDA #32	STA BUFCNT	LDA SECLEN	BMI IBUFA1		LSR BUFCNTIBUFA1	LDA SECNUM+1	BNE IBUFA2	LDA SECNUM	CMP BUFCNT	BCS IBUFA2	STA BUFCNTIBUFA2	LDA BUFCNT	STA BUFSEC	RTS***RECSEC	LDX #$10	LDA #CGETR	STA ICCOM,X	LDA BUFADR	STA ICBADR,X	LDA BUFADR+1	STA ICBADR+1,X	LDA SECCNT+1	BNE RECSEC1	LDA SECCNT	CMP #4	BCS RECSEC1	LDA #128	STA ICBLEN,X	LDA #0	STA ICBLEN+1,X	BEQ RECSEC2RECSEC1	LDA SECLEN	STA ICBLEN,X	LDA SECLEN+1	STA ICBLEN+1,XRECSEC2	JMP CIOV*ACK	LDX #$10	LDA #CPUTR	STA ICCOM,X	LDA #0	STA ICBLEN,X	STA ICBLEN+1,X	LDA #'A	JMP CIOV***WRISEC	LDA #'P	STA DCOMND	LDA #'1	STA DDEVIC	LDA #2	STA DUNIT	LDA BUFADR	STA DBUFLO	LDA BUFADR+1	STA DBUFHI	LDA SECLEN	STA DBYTLO	LDA SECLEN+1	STA DBYTHI	LDA SECCNT	STA DAUX1	LDA SECCNT+1	STA DAUX2	LDA #$80	STA DSTATS	JMP SIOV***OPENSER	LDX #$10	LDA #COPEN	STA ICCOM,X	LDA #RNAME:L	STA ICBADR,X	LDA #RNAME:H	STA ICBADR+1,X	LDA #1	STA ICBLEN,X	STA ICBLEN+1,X	LDA #12	STA ICAUX1,X	LDA #0	STA ICAUX2,X		JSR CIOV	LDA #CBAUD	STA ICCOM,X	LDA #14	STA ICAUX1,X	LDA #0	STA ICAUX2,X	JSR CIOV	LDA #CTRANS	STA ICCOM,X	LDA #32	STA ICAUX1,X	LDA #0	STA ICAUX2,X	JSR CIOV	LDA #CCONCUR	STA ICCOM,X	LDA #0	STA ICAUX1,X	STA ICAUX2,X	JMP CIOV***PRTSTR	LDY #0	LDA (PTR),Y	BEQ INCPTR	JSR PRINT	JSR INCPTR	JMP PRTSTRINCPTR	INC PTR	BNE INCPTR1	INC PTR+1INCPTR1	RTS*GEOUTCH	CLC	LDA $E406	ADC #1	STA OUTCH+1	LDA $E407	ADC #0	STA OUTCH+2	RTSNEWLINE	LDA #EOLPRINT	PHA	TXA	PHA	TYA	PHA	TSX	LDA $103,X	JSR OUTCH	PLA	TAY	PLA	TAX	PLA	RTSGETKEY	LDA $E425	PHA	LDA $E424	PHA	RTS*PRTWORD	JSR WORD2D	LDX #0	LDY #0PRTWRD1	LDA PACKDEC,Y	LSR	LSR	LSR	LSR	JSR PRTNIB	CPY #2	BNE PRTWRD2	INXPRTWRD2	LDA PACKDEC,Y	AND #15	JSR PRTNIB	INY	CPY #3	BNE PRTWRD1	LDX #0	JMP NEWLINEPRTNIB	BNE PRTNIB1	CPX #0	BNE PRTNIB1	RTSPRTNIB1	INX	CLC	ADC #'0	JMP PRINTWORD2D	STX WORD+1	STA WORD	LDX #2	LDA #0WORD2D1	STA PACKDEC,X	DEX	BPL WORD2D1	SED	LDX #16WORD2D3	ASL WORD	ROL WORD+1	LDY #2WORD2D2	LDA PACKDEC,Y	ADC PACKDEC,Y	STA PACKDEC,Y	DEY	BPL WORD2D2	DEX	BNE WORD2D3	CLD	RTS*PUTHEX	PHA	TXA	PHA	TYA	PHA	TSX	LDA $103,X	LSR	LSR	LSR	LSR	JSR PUTNIB	LDA $103,X	AND #15	JSR PUTNIB	PLA	TYA	PLA	TAX	PLA	RTSPUTNIB	CLC	ADC #'0	CMP #'9+1	BCC PUTNIB1	ADC #6PUTNIB1	JMP PRINT** VAR + CONST*PERCOM	DFW 0,0,0,0,0,0WORD	DFW 0PACKDEC	DFB 0,0,0OUTCH	JMP 0*RNAME	ASC "R:"	DFB $9BSECLEN	DFW 0SECNUM	DFW 0SECCNT	DFW 0BUFCNT	DFB 0BUFSEC	DFB 0BUFADR	DFW 0TEXT	ASC "SECLEN: "	DFB 0	ASC "NUMSEC: "	DFB 0ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿ